window.CMB2=function(a,b,c,d){"use strict";var e=a.cmb2_l10,f=a.setTimeout,g={idNumber:!1,repeatEls:'input:not([type="button"],[id^=filelist]),select,textarea,.cmb2-media-status',noEmpty:'input:not([type="button"]):not([type="radio"]):not([type="checkbox"]),textarea',repeatUpdate:'input:not([type="button"]),select,textarea,label',styleBreakPoint:450,mediaHandlers:{},neweditor_id:[],defaults:{time_picker:e.defaults.time_picker,date_picker:e.defaults.date_picker,color_picker:e.defaults.color_picker||{}},media:{frames:{}}},h=function(a){return c(b.getElementById(a))};return g.metabox=function(){return g.$metabox?g.$metabox:(g.$metabox=c(".cmb2-wrap > .cmb2-metabox"),g.$metabox)},g.init=function(){g.log("CMB2 localized data",e);var b=g.metabox(),d=b.find(".cmb-repeatable-group");g.initPickers(b.find('input[type="text"].cmb2-timepicker'),b.find('input[type="text"].cmb2-datepicker'),b.find('input[type="text"].cmb2-colorpicker')),h("ui-datepicker-div").wrap('<div class="cmb2-element" />'),c('<p><span class="button cmb-multicheck-toggle">'+e.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)"),g.makeListSortable(),b.on("change",".cmb2_upload_file",function(){g.media.field=c(this).attr("id"),h(g.media.field+"_id").val("")}).on("click",".cmb-multicheck-toggle",g.toggleCheckBoxes).on("click",".cmb2-upload-button",g.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",g.handleFileClick).on("click",".cmb2-remove-file-button",g.handleRemoveMedia).on("click",".cmb-add-group-row",g.addGroupRow).on("click",".cmb-add-row-button",g.addAjaxRow).on("click",".cmb-remove-group-row",g.removeGroupRow).on("click",".cmb-remove-row-button",g.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",g.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",g.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",g.toggleHandle),d.length&&d.filter(".sortable").each(function(){c(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+e.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+e.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",g.shiftRows).on("cmb2_add_row",g.emptyValue),f(g.resizeoEmbeds,500),c(a).on("resize",g.resizeoEmbeds)},g.resetTitlesAndIterator=function(){c(".cmb-repeatable-group").each(function(){var a=c(this);a.find(".cmb-repeatable-grouping").each(function(b){var d=c(this);d.data("iterator",b),d.find(".cmb-group-title h4").text(a.find(".cmb-add-group-row").data("grouptitle").replace("{#}",b+1))})})},g.toggleHandle=function(a){a.preventDefault(),c(b).trigger("postbox-toggled",c(this).parent(".postbox").toggleClass("closed"))},g.toggleCheckBoxes=function(a){a.preventDefault();var b=c(this),d=b.closest(".cmb-td").find("input[type=checkbox]:not([disabled])");b.data("checked")?(d.prop("checked",!1),b.data("checked",!1)):(d.prop("checked",!0),b.data("checked",!0))},g.handleMedia=function(a){a.preventDefault();var b=c(this);g.attach_id=b.hasClass("cmb2-upload-list")?!1:b.closest(".cmb-td").find(".cmb2-upload-file-id").val(),g.attach_id="0"!==g.attach_id?g.attach_id:!1,g._handleMedia(b.prev("input.cmb2-upload-file").attr("id"),b.hasClass("cmb2-upload-list"))},g.handleFileClick=function(a){a.preventDefault();var b=c(this),d=b.closest(".cmb-td"),e=d.find(".cmb2-upload-button").hasClass("cmb2-upload-list");g.attach_id=e?b.find('input[type="hidden"]').data("id"):d.find(".cmb2-upload-file-id").val(),g.attach_id&&g._handleMedia(d.find("input.cmb2-upload-file").attr("id"),e,g.attach_id)},g._handleMedia=function(a,b){if(wp){var d=g.media;d.field=a,d.$field=h(d.field),d.fieldData=d.$field.data(),d.previewSize=d.fieldData.previewsize,d.fieldName=d.$field.attr("name");var f,i;if(d.field in d.frames)return void d.frames[d.field].open();d.frames[d.field]=wp.media({title:g.metabox().find("label[for="+d.field+"]").text(),library:d.fieldData.queryargs||{},button:{text:e.strings[b?"upload_files":"upload_file"]},multiple:b?"add":!1}),g.mediaHandlers.list=function(a,b){i=a.toJSON(),d.$field.val(i.url),h(d.field+"_id").val(i.id);var g=[];return c(i).each(function(){if(this.type&&"image"===this.type){var a=d.previewSize[0]?d.previewSize[0]:50,b=d.previewSize[1]?d.previewSize[1]:50;f='<li class="img-status"><img width="'+a+'" height="'+b+'" src="'+this.url+'" class="attachment-'+a+"px"+b+'px" alt="'+this.filename+'"><p><a href="#" class="cmb2-remove-file-button" rel="'+d.field+"["+this.id+']">'+e.strings.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+d.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}else f='<li class="file-status"><span>'+e.strings.file+" <strong>"+this.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+e.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+d.field+"["+this.id+']">'+e.strings.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+d.fieldName+"["+this.id+']" value="'+this.url+'"></li>';g.push(f)}),b?g:void c(g).each(function(){d.$field.siblings(".cmb2-media-status").slideDown().append(this)})},g.mediaHandlers.single=function(a){if(i=a.first().toJSON(),d.$field.val(i.url),h(d.field+"_id").val(i.id),i.type&&"image"===i.type){var b=d.previewSize[0]?d.previewSize[0]:350;f='<div class="img-status"><img width="'+b+'px" style="max-width: '+b+'px; width: 100%; height: auto;" src="'+i.url+'" alt="'+i.filename+'" title="'+i.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+d.field+'">'+e.strings.remove_image+"</a></p></div>"}else f='<div class="file-status"><span>'+e.strings.file+" <strong>"+i.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+i.url+'" target="_blank" rel="external">'+e.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+d.field+'">'+e.strings.remove_file+"</a>)</div>";d.$field.siblings(".cmb2-media-status").slideDown().html(f)},g.mediaHandlers.selectFile=function(){var a=d.frames[d.field].state().get("selection"),e=b?"list":"single";return g.attach_id&&b?void c('[data-id="'+g.attach_id+'"]').parents("li").replaceWith(g.mediaHandlers.list(a,!0)):void g.mediaHandlers[e](a)},g.mediaHandlers.openModal=function(){var a=d.frames[d.field].state().get("selection");if(!g.attach_id)return a.reset();var b=wp.media.attachment(g.attach_id);b.fetch(),a.set(b?[b]:[])},d.frames[d.field].on("select",g.mediaHandlers.selectFile).on("open",g.mediaHandlers.openModal),d.frames[d.field].open()}},g.handleRemoveMedia=function(a){a.preventDefault();var b=c(this);return b.is(".cmb-attach-list .cmb2-remove-file-button")?(b.parents("li").remove(),!1):(g.media.field=b.attr("rel"),g.metabox().find("input#"+g.media.field).val(""),g.metabox().find("input#"+g.media.field+"_id").val(""),b.parents(".cmb2-media-status").html(""),!1)},g.cleanRow=function(a,b,e){var f=a.find(g.repeatUpdate);if(e){var h=a.find("[id]").not(g.repeatUpdate);a.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove(),h.length&&h.each(function(){var d=c(this),e=d.attr("id"),f=e.replace("_"+b,"_"+g.idNumber),h=a.find('[data-selector="'+e+'"]');d.attr("id",f),h.length&&h.attr("data-selector",f).data("selector",f)})}return g.neweditor_id=[],f.filter(":checked").prop("checked",!1),f.filter(":selected").prop("selected",!1),a.find("h3.cmb-group-title").length&&a.find("h3.cmb-group-title").text(a.data("title").replace("{#}",g.idNumber+1)),f.each(function(){var m,n,o,p,q,s,a=c(this),f=a.hasClass("wp-editor-area"),h=a.attr("for"),i=a.attr("value"),j=a.prop("type"),k="radio"===j||"checkbox"===j?i:!1,l={};if(h?l={"for":h.replace("_"+b,"_"+g.idNumber)}:(p=a.attr("name"),n=a.attr("id"),e?(o=p?p.replace("["+b+"]","["+g.idNumber+"]"):"",m=n?n.replace("_"+b,"_"+g.idNumber):"",a.parents(".empty-row").length>0&&(q=o?o.split(/\[/):!1,s=o?q.length:0,"]"==q[s-1]?(q[s-2]="1]",o=q.join("[",q),m=m?m.substring(0,m.lastIndexOf("_"))+"_1":""):(q[s-1]="1]",o=q?q.join("[",q):"",m=m?m.substring(0,m.lastIndexOf("_"))+"_1":""))):(q=p?p.split(/\[/):!1,s=p?q.length:0,"]"==q[s-1]?(q[s-2]=g.idNumber+"]",o=q.join("[",q),m=n?n.substring(0,n.lastIndexOf("_"))+"_"+g.idNumber:""):(q[s-1]=g.idNumber+"]",o=q?q.join("[",q):"",m=n?n.substring(0,n.lastIndexOf("_"))+"_"+g.idNumber:"")),l={id:m,name:o,"data-iterator":g.idNumber}),(d!==typeof i&&i||k)&&(l.value=k?k:""),"TEXTAREA"===a.prop("tagName")&&a.html(""),k&&a.removeAttr("checked"),a.removeClass("hasDatepicker").attr(l).val(k?k:""),f){m=m?n.replace("zx"+b,"zx"+g.idNumber):"",a.html("");var t=a.parents(".cmb-type-wysiwyg");t.find(".mce-tinymce:not(:first-child)").remove();var u=t.html().replace(new RegExp(n,"g"),m);t.html(u),g.neweditor_id.push({id:m,old:n})}}),g},g.newRowHousekeeping=function(a){var b=a.find(".wp-picker-container"),d=a.find(".cmb2-media-status");return b.length&&b.each(function(){var a=c(this).parent();a.html(a.find('input[type="text"].cmb2-colorpicker').attr("style",""))}),d.length&&d.empty(),g},g.afterRowInsert=function(a){var b;if(g.neweditor_id.length){var c;for(c=g.neweditor_id.length-1;c>=0;c--){var d=g.neweditor_id[c].id,e=g.neweditor_id[c].old;if("undefined"==typeof tinyMCEPreInit.mceInit[d]){var f=jQuery.extend({},tinyMCEPreInit.mceInit[e]);for(b in f)"string"==typeof f[b]&&(f[b]=f[b].replace(new RegExp(e,"g"),d));tinyMCEPreInit.mceInit[d]=f}if("undefined"==typeof tinyMCEPreInit.qtInit[d]){var h=jQuery.extend({},tinyMCEPreInit.qtInit[e]);for(b in h)"string"==typeof h[b]&&(h[b]=h[b].replace(new RegExp(e,"g"),d));tinyMCEPreInit.qtInit[d]=h}tinyMCE.init({id:tinyMCEPreInit.mceInit[d]})}}g.initPickers(a.find('input[type="text"].cmb2-timepicker'),a.find('input[type="text"].cmb2-datepicker'),a.find('input[type="text"].cmb2-colorpicker'))},g.updateNameAttr=function(){var a=c(this),b=a.attr("name");if("undefined"!=typeof b){var d=parseInt(a.parents(".cmb-repeatable-grouping").data("iterator")),e=d-1,f=b.replace("["+d+"]","["+e+"]");a.attr("name",f)}},g.emptyValue=function(a,b){c(g.noEmpty,b).val("")},g.addGroupRow=function(a){a.preventDefault();var b=c(this);b.trigger("cmb2_add_group_row_start",b);var d=h(b.data("selector")),e=d.find(".cmb-repeatable-grouping").last(),f=parseInt(e.data("iterator"));g.idNumber=f+1;var i=e.clone();g.newRowHousekeeping(i.data("title",b.data("grouptitle"))).cleanRow(i,f,!0),i.find(".cmb-add-row-button").prop("disabled",!1);var j=c('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+g.idNumber+'">'+i.html()+"</div>");e.after(j),g.afterRowInsert(j),d.find(".cmb-repeatable-grouping").length<=1?d.find(".cmb-remove-group-row").prop("disabled",!0):d.find(".cmb-remove-group-row").prop("disabled",!1),d.trigger("cmb2_add_row",j)},g.addAjaxRow=function(a){a.preventDefault();var b=c(this),d=h(b.data("selector")),e=d.find(".empty-row"),f=parseInt(e.find("[data-iterator]").data("iterator"));g.idNumber=f+1;var i=e.clone();g.newRowHousekeeping(i).cleanRow(i,f),e.removeClass("empty-row hidden").addClass("cmb-repeat-row"),e.after(i),g.afterRowInsert(i),d.trigger("cmb2_add_row",i),d.find(".cmb-remove-row-button").removeClass("button-disabled")},g.removeGroupRow=function(a){a.preventDefault();var b=c(this),d=h(b.data("selector")),e=b.parents(".cmb-repeatable-grouping"),f=d.find(".cmb-repeatable-grouping").length;f>1&&(d.trigger("cmb2_remove_group_row_start",b),e.nextAll(".cmb-repeatable-grouping").find(g.repeatEls).each(g.updateNameAttr),e.remove(),2>=f?d.find(".cmb-remove-group-row").prop("disabled",!0):d.find(".cmb-remove-group-row").prop("disabled",!1),d.trigger("cmb2_remove_row"))},g.removeAjaxRow=function(a){a.preventDefault();var b=c(this);if(!b.hasClass("button-disabled")){var d=b.parents(".cmb-row"),e=b.parents(".cmb-repeat-table"),f=e.find(".cmb-row").length;f>2?(d.hasClass("empty-row")&&d.prev().addClass("empty-row").removeClass("cmb-repeat-row"),b.parents(".cmb-repeat-table .cmb-row").remove(),3===f&&e.find(".cmb-remove-row-button").addClass("button-disabled"),e.trigger("cmb2_remove_row")):b.addClass("button-disabled")}},g.shiftRows=function(a){a.preventDefault();var b=c(this);b.trigger("cmb2_shift_rows_enter",b);var d=b.parents(".cmb-repeatable-grouping"),e=b.hasClass("move-up")?d.prev(".cmb-repeatable-grouping"):d.next(".cmb-repeatable-grouping");if(e.length){b.trigger("cmb2_shift_rows_start",b);var f=[];d.find(g.repeatEls).each(function(){var d,a=c(this),b=a.attr("type");d=a.hasClass("cmb2-media-status")?a.html():"checkbox"===b||"radio"===b?a.is(":checked"):"select"===a.prop("tagName")?a.is(":selected"):a.val(),f.push({val:d,$:a})}),e.find(g.repeatEls).each(function(a){var e,b=c(this),d=b.attr("type");if(b.hasClass("cmb2-media-status")){var g=b.closest(".cmb-repeatable-grouping").attr("data-iterator"),h=f[a].$.closest(".cmb-repeatable-grouping").attr("data-iterator");e=b.html(),b.html(f[a].val),f[a].$.html(e),f[a].$.find("input").each(function(){var a=c(this).attr("name");a=a.replace("["+g+"]","["+h+"]"),c(this).attr("name",a)}),b.find("input").each(function(){var a=c(this).attr("name");a=a.replace("["+h+"]","["+g+"]"),c(this).attr("name",a)})}else"checkbox"===d?(f[a].$.prop("checked",b.is(":checked")),b.prop("checked",f[a].val)):"radio"===d?(b.is(":checked")&&f[a].$.attr("data-checked","true"),f[a].$.is(":checked")&&b.attr("data-checked","true")):"select"===b.prop("tagName")?(f[a].$.prop("selected",b.is(":selected")),b.prop("selected",f[a].val)):(f[a].$.val(b.val()),b.val(f[a].val))}),d.find("input[data-checked=true]").prop("checked",!0).removeAttr("data-checked"),e.find("input[data-checked=true]").prop("checked",!0).removeAttr("data-checked"),b.trigger("cmb2_shift_rows_complete",b)}},g.initPickers=function(a,b,c){g.initTimePickers(a),g.initDatePickers(b),g.initColorPickers(c)},g.initTimePickers=function(a){a.length&&(a.timepicker("destroy"),a.timepicker(g.defaults.time_picker))},g.initDatePickers=function(a){a.length&&(a.datepicker("destroy"),a.datepicker(g.defaults.date_picker))},g.initColorPickers=function(a){a.length&&("object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker?a.wpColorPicker(g.defaults.color_picker):a.each(function(a){c(this).after('<div id="picker-'+a+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),h("picker-"+a).hide().farbtastic(c(this))}).focus(function(){c(this).next().show()}).blur(function(){c(this).next().hide()}))},g.makeListSortable=function(){var a=g.metabox().find(".cmb2-media-status.cmb-attach-list");a.length&&a.sortable({cursor:"move"}).disableSelection()},g.maybeOembed=function(a){var b=c(this),d=a.type,e={focusout:function(){f(function(){g.spinner(".postbox .cmb2-metabox",!0)},2e3)},keyup:function(){var c=function(b,c){return a.which<=c&&a.which>=b};(c(48,90)||c(96,111)||c(8,9)||187===a.which||190===a.which)&&g.doAjax(b,a)},paste:function(){f(function(){g.doAjax(b)},100)}};e[d]()},g.resizeoEmbeds=function(){g.metabox().each(function(){var a=c(this),b=a.parents(".inside"),d=a.parents(".inner-sidebar").length||a.parents("#side-sortables").length,e=d,f=!1;if(!b.length)return!0;var h=b.width();g.styleBreakPoint>h&&(e=!0,f=g.styleBreakPoint-62>h),h=e?h:Math.round(.82*b.width()*.97);var i=h-30;if(!e||d||f||(i-=75),i>639)return!0;var j=a.find(".cmb-type-oembed .embed-status"),k=j.children().not(".cmb2-remove-wrapper");return k.length?void k.each(function(){var a=c(this),b=a.width(),d=a.height(),f=i;a.parents(".cmb-repeat-row").length&&!e&&(f=i-91,f=785>h?f-15:f);var g=Math.round(f*d/b);a.width(f).height(g)}):!0})},g.log=function(){e.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},g.spinner=function(a,b){b?c(".cmb-spinner",a).hide():c(".cmb-spinner",a).show()},g.doAjax=function(a){var b=a.val();if(!(b.length<6)){var d=a.attr("id"),h=a.closest(".cmb-td"),i=h.find(".embed-status"),j=h.find(".embed_wrap"),k=i.find(":first-child"),l=i.length&&k.length?k.width():a.width();g.log("oembed_url",b,d),g.spinner(h),j.html(""),f(function(){c(".cmb2-oembed:focus").val()===b&&c.ajax({type:"post",dataType:"json",url:e.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:b,oembed_width:l>300?l:300,field_id:d,object_id:a.data("objectid"),object_type:a.data("objecttype"),cmb2_ajax_nonce:e.ajax_nonce},success:function(a){g.log(a),g.spinner(h,!0),j.html(a.data)}})},500)}},c(b).ready(g.init),g}(window,document,jQuery);
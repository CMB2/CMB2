window.CMB2=function(e,t,n,r){"use strict";var i=e.cmb2_l10;var s=e.setTimeout;var o={formfield:"",idNumber:false,file_frames:{},repeatEls:'input:not([type="button"]),select,textarea,.cmb2-media-status',defaults:{time_picker:i.defaults.time_picker,date_picker:i.defaults.date_picker,color_picker:i.defaults.color_picker||{}},styleBreakPoint:450};o.metabox=function(){if(o.$metabox){return o.$metabox}o.$metabox=n(".cmb2-wrap > .cmb2-metabox");return o.$metabox};o.init=function(){o.log("CMB2 localized data",i);var t=o.metabox();var r=t.find(".cmb-repeatable-group");o.initPickers(t.find('input[type="text"].cmb2-timepicker'),t.find('input[type="text"].cmb2-datepicker'),t.find('input[type="text"].cmb2-colorpicker'));n("#ui-datepicker-div").wrap('<div class="cmb2-element" />');n('<p><span class="button cmb-multicheck-toggle">'+i.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)");o.makeListSortable();t.on("change",".cmb2_upload_file",function(){o.formfield=n(this).attr("id");n("#"+o.formfield+"_id").val("")}).on("click",".cmb-multicheck-toggle",o.toggleCheckBoxes).on("click",".cmb2-upload-button",o.handleMedia).on("click",".cmb2-remove-file-button",o.handleRemoveMedia).on("click",".cmb-add-group-row",o.addGroupRow).on("click",".cmb-add-row-button",o.addAjaxRow).on("click",".cmb-remove-group-row",o.removeGroupRow).on("click",".cmb-remove-row-button",o.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",o.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",o.resetTitlesAndIterator);if(r.length){r.filter(".sortable").each(function(){n(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+i.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+i.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",o.shiftRows).on("cmb2_add_row",o.emptyValue)}s(o.resizeoEmbeds,500);n(e).on("resize",o.resizeoEmbeds)};o.resetTitlesAndIterator=function(){n(".cmb-repeatable-group").each(function(){var e=n(this);e.find(".cmb-repeatable-grouping").each(function(t){var r=n(this);r.data("iterator",t);r.find(".cmb-group-title h4").text(e.find(".cmb-add-group-row").data("grouptitle").replace("{#}",t+1))})})};o.toggleCheckBoxes=function(e){e.preventDefault();var t=n(this);var r=t.closest(".cmb-td").find("input[type=checkbox]");if(t.data("checked")){r.prop("checked",false);t.data("checked",false)}else{r.prop("checked",true);t.data("checked",true)}};o.handleMedia=function(e){if(!wp){return}e.preventDefault();var t=o.metabox();var r=n(this);o.formfield=r.prev("input").attr("id");var s=n("#"+o.formfield);var u=s.data("previewsize");var a=s.attr("name");var f=true;var l=true;var c=r.hasClass("cmb2-upload-list");if(o.formfield in o.file_frames){o.file_frames[o.formfield].open();return}o.file_frames[o.formfield]=wp.media.frames.file_frame=wp.media({title:t.find("label[for="+o.formfield+"]").text(),button:{text:i.strings.upload_file},multiple:c?true:false});var h={list:function(e){l=e.toJSON();s.val(l.url);n("#"+o.formfield+"_id").val(l.id);var t=[];n(l).each(function(){if(this.type&&this.type==="image"){var e=u[0]?u[0]:50;var n=u[1]?u[1]:50;f='<li class="img-status">'+'<img width="'+e+'" height="'+n+'" src="'+this.url+'" class="attachment-'+e+"px"+n+'px" alt="'+this.filename+'">'+'<p><a href="#" class="cmb2-remove-file-button" rel="'+o.formfield+"["+this.id+']">'+i.strings.remove_image+"</a></p>"+'<input type="hidden" id="filelist-'+this.id+'" name="'+a+"["+this.id+']" value="'+this.url+'">'+"</li>"}else{f="<li>"+i.strings.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+i.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+o.formfield+"["+this.id+']">'+i.strings.remove_file+"</a>)"+'<input type="hidden" id="filelist-'+this.id+'" name="'+a+"["+this.id+']" value="'+this.url+'">'+"</li>"}t.push(f)});n(t).each(function(){s.siblings(".cmb2-media-status").slideDown().append(this)})},single:function(e){l=e.first().toJSON();s.val(l.url);n("#"+o.formfield+"_id").val(l.id);if(l.type&&l.type==="image"){var t=u[0]?u[0]:350;f='<div class="img-status"><img width="'+t+'px" style="max-width: '+t+'px; width: 100%; height: auto;" src="'+l.url+'" alt="'+l.filename+'" title="'+l.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+o.formfield+'">'+i.strings.remove_image+"</a></p></div>"}else{f=i.strings.file+" <strong>"+l.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+l.url+'" target="_blank" rel="external">'+i.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+o.formfield+'">'+i.strings.remove_file+"</a>)"}s.siblings(".cmb2-media-status").slideDown().html(f)}};o.file_frames[o.formfield].on("select",function(){var e=o.file_frames[o.formfield].state().get("selection");var t=c?"list":"single";h[t](e)});o.file_frames[o.formfield].open()};o.handleRemoveMedia=function(e){e.preventDefault();var t=n(this);if(t.is(".cmb-attach-list .cmb2-remove-file-button")){t.parents("li").remove();return false}o.formfield=t.attr("rel");var r=t.parents(".img-status");o.metabox().find("input#"+o.formfield).val("");o.metabox().find("input#"+o.formfield+"_id").val("");if(!r.length){t.parents(".cmb2-media-status").html("")}else{r.html("")}return false};n.fn.replaceText=function(e,t,r){return this.each(function(){var i=this.firstChild,s,o,u=[];if(i){do{if(i.nodeType===3){s=i.nodeValue;o=s.replace(e,t);if(o!==s){if(!r&&/</.test(o)){n(i).before(o);u.push(i)}else{i.nodeValue=o}}}}while(i=i.nextSibling)}if(u.length){n(u).remove()}})};n.fn.cleanRow=function(e,t){var r=n(this);var i=r.find('input:not([type="button"]), select, textarea, label, div');if(t){r.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove()}o.neweditor_id=[];i.filter(":checked").prop("checked",false);i.filter(":selected").prop("selected",false);i.find(".quicktags-toolbar, .mce-container").remove();if(r.find("h3.cmb-group-title").length){r.find("h3.cmb-group-title").text(r.data("title").replace("{#}",o.idNumber+1))}i.each(function(){var t=n(this);var r=t.hasClass("wp-editor-area");var i=t.attr("for");var s={};var u,a;if(t.prop("tagName")=="LABEL"){s={"for":i.replace("_"+e,"_"+o.idNumber)}}else if(t.prop("tagName")=="DIV"){var f=t.attr("class");var l=f?f.replace("-"+e,"-"+o.idNumber):"";var c=t.attr("id");var h=c?c.replace("_"+e,"_"+o.idNumber):"";if(t.attr("id"))s["id"]=h;if(t.attr("class"))s["class"]=l;if(t.attr("data-iterator"))s["data-iterator"]=o.idNumber}else{var p=t.attr("name");var d=t.val();var v=p?p.replace("["+e+"]","["+o.idNumber+"]"):"";a=t.attr("id");u=a?a.replace("_"+e,"_"+o.idNumber):"";s={id:u,name:v,"data-iterator":o.idNumber,value:""};if("radio"==t.attr("type")||"checkbox"==t.attr("type")||"SELECT"==t.prop("tagName")){s["value"]=d;s["selected"]=false;s["checked"]=false;t.find("option").attr("checked",false).attr("selected",false)}}t.removeClass("hasDatepicker").val("");t.attr(s);if(r){t.html("");var m=t.parents(".cmb-type-wysiwyg");m.find(".mce-tinymce:not(:first-child)").remove();var g=m.html().replace(new RegExp(a,"g"),u);m.html(g);o.neweditor_id.push({id:u,old:a})}});return this};n.fn.newRowHousekeeping=function(){var e=n(this);var t=e.find(".wp-picker-container");var r=e.find(".cmb2-media-status");if(t.length){t.each(function(){var e=n(this).parent();e.html(e.find('input[type="text"].cmb2-colorpicker').attr("style",""))})}if(r.length){r.empty()}return this};o.afterRowInsert=function(e,t){var r=e.find('input:not([type="button"]), textarea, select').first();if(r.length){if(t){n("html, body").animate({scrollTop:Math.round(r.offset().top-150)},1e3)}r.focus()}var i;if(o.neweditor_id.length){var s;for(s=o.neweditor_id.length-1;s>=0;s--){var u=o.neweditor_id[s].id;var a=o.neweditor_id[s].old;if(typeof tinyMCEPreInit.mceInit[u]==="undefined"){var f=jQuery.extend({},tinyMCEPreInit.mceInit[a]);for(i in f){if("string"===typeof f[i]){f[i]=f[i].replace(new RegExp(a,"g"),u)}}tinyMCEPreInit.mceInit[u]=f}if(typeof tinyMCEPreInit.qtInit[u]==="undefined"){var l=jQuery.extend({},tinyMCEPreInit.qtInit[a]);for(i in l){if("string"===typeof l[i]){l[i]=l[i].replace(new RegExp(a,"g"),u)}}tinyMCEPreInit.qtInit[u]=l}QTags(tinyMCEPreInit.qtInit[u]);QTags._buttonsInit();if(jQuery("#"+u).closest(".wp-editor-wrap").find(".wp-switch-editor").length>0){tinyMCE.init({id:tinyMCEPreInit.mceInit[u]})}if(!jQuery("#"+u).closest(".wp-editor-wrap").hasClass("html-active")&&jQuery("#"+u).closest(".wp-editor-wrap").find(".wp-switch-editor").length>0){switchEditors.go(u,"html");switchEditors.go(u,"tmce")}}}o.initPickers(e.find('input[type="text"].cmb2-timepicker'),e.find('input[type="text"].cmb2-datepicker'),e.find('input[type="text"].cmb2-colorpicker'))};o.updateNameAttr=function(){var e=n(this);var t=e.attr("name");if(typeof t==="undefined"){return false}var r=parseInt(e.parents(".cmb-repeatable-grouping").data("iterator"));var i=r-1;var s=t.replace("["+r+"]","["+i+"]");e.attr("name",s)};o.emptyValue=function(e,t){n('input:not([type="button"]):not([type="checkbox"]):not([type="radio"]), textarea',t).val("")};o.addGroupRow=function(e){e.preventDefault();var t=n(this);var r=n("#"+t.data("selector"));var i=r.find(".cmb-repeatable-grouping").last();var s=parseInt(i.data("iterator"));o.idNumber=s+1;var u=i.clone();u.data("title",t.data("grouptitle")).newRowHousekeeping().cleanRow(s,true);var a=n('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+o.idNumber+'">'+u.html()+"</div>");i.after(a);o.afterRowInsert(a,true);if(r.find(".cmb-repeatable-grouping").length<=1){r.find(".cmb-remove-group-row").prop("disabled",true)}else{r.find(".cmb-remove-group-row").prop("disabled",false)}r.trigger("cmb2_add_row",a);n(".postbox .hndle, .postbox .handlediv").unbind("click.postboxes");postboxes.add_postbox_toggles(pagenow)};o.addAjaxRow=function(e){e.preventDefault();var t=n(this);var r="#"+t.data("selector");var i=n(r);var s=i.find(".empty-row");var u=parseInt(s.find("[data-iterator]").data("iterator"));o.idNumber=u+1;var a=s.clone();a.newRowHousekeeping().cleanRow(u);s.removeClass("empty-row hidden").addClass("cmb-repeat-row");s.after(a);o.afterRowInsert(a);i.trigger("cmb2_add_row",a);i.find(".cmb-remove-row-button").removeClass("button-disabled")};o.removeGroupRow=function(e){e.preventDefault();var t=n(this);var r=n("#"+t.data("selector"));var i=t.parents(".cmb-repeatable-grouping");var s=r.find(".cmb-repeatable-grouping").length;if(s>1){i.nextAll(".cmb-repeatable-grouping").find(o.repeatEls).each(o.updateNameAttr);i.remove();if(s<=2){r.find(".cmb-remove-group-row").prop("disabled",true)}else{r.find(".cmb-remove-group-row").prop("disabled",false)}r.trigger("cmb2_remove_row")}};o.removeAjaxRow=function(e){e.preventDefault();var t=n(this);if(t.hasClass("button-disabled")){return}var r=t.parents(".cmb-row");var i=t.parents(".cmb-repeat-table");var s=i.find(".cmb-row").length;if(s>2){if(r.hasClass("empty-row")){r.prev().addClass("empty-row").removeClass("cmb-repeat-row")}t.parents(".cmb-repeat-table .cmb-row").remove();if(s===3){i.find(".cmb-remove-row-button").addClass("button-disabled")}i.trigger("cmb2_remove_row")}else{t.addClass("button-disabled")}};o.shiftRows=function(e){e.preventDefault();var t=n(this);var r=t.parents(".cmb-repeatable-grouping");var i=t.hasClass("move-up")?r.prev(".cmb-repeatable-grouping"):r.next(".cmb-repeatable-grouping");if(!i.length){return}var s=[];r.find(o.repeatEls).each(function(){var e=n(this);var t;if(e.hasClass("cmb2-media-status")){t=e.html()}else if("checkbox"==e.attr("type")||"radio"==e.attr("type")){t=e.is(":checked")}else if("SELECT"==e.prop("tagName")){t=""}else if("TEXTAREA"===e.prop("tagName")){var r=e.attr("id"),i;if(jQuery("#"+r).closest(".wp-editor-wrap").hasClass("html-active"))i="html";else i="tmce";if(i=="tmce")switchEditors.go(r,"html");t=e.val();if(i=="tmce")switchEditors.go(r,"tmce")}else{t=e.val()}s.push({val:t,$:e})});i.find(o.repeatEls).each(function(e){var t=n(this);var r;if(t.hasClass("cmb2-media-status")){r=t.html();t.html(s[e]["val"]);s[e]["$"].html(r)}else if("checkbox"===t.attr("type")||"radio"===t.attr("type")){s[e]["$"].prop("checked",t.is(":checked"));t.prop("checked",s[e]["val"])}else if("SELECT"===t.prop("tagName")){var i=s[e]["$"].find("option"),o=t.find("option"),u=s[e]["$"].find("option:selected").val(),a=t.find("option:selected").val();i.prop("selected",false);o.prop("selected",false);i.each(function(e,t){if(jQuery(t).val()==a)jQuery(t).prop("selected",true)});o.each(function(e,t){if(jQuery(t).val()==u)jQuery(t).prop("selected",true)})}else if("TEXTAREA"===t.prop("tagName")){var f,l;var c=s[e]["$"].attr("id"),h=t.attr("id");if(jQuery("#"+c).closest(".wp-editor-wrap").hasClass("html-active"))f="html";else f="tmce";if(jQuery("#"+h).closest(".wp-editor-wrap").hasClass("html-active"))l="html";else l="tmce";if(f=="tmce")switchEditors.go(c,"html");if(l=="tmce")switchEditors.go(h,"html");s[e]["$"].val(t.val());t.val(s[e]["val"]);if(f=="tmce")switchEditors.go(c,"tmce");if(l=="tmce")switchEditors.go(h,"tmce")}else{s[e]["$"].val(t.val());t.val(s[e]["val"])}});o.initPickers(r.find('input[type="text"].cmb2-timepicker'),r.find('input[type="text"].cmb2-datepicker'),r.find('input[type="text"].cmb2-colorpicker'));o.initPickers(i.find('input[type="text"].cmb2-timepicker'),i.find('input[type="text"].cmb2-datepicker'),i.find('input[type="text"].cmb2-colorpicker'))};o.initPickers=function(e,t,n){o.initTimePickers(e);o.initDatePickers(t);o.initColorPickers(n)};o.initTimePickers=function(e){if(!e.length){return}e.timePicker(o.defaults.time_picker)};o.initDatePickers=function(e){if(!e.length){return}e.datepicker("destroy");e.datepicker(o.defaults.date_picker)};o.initColorPickers=function(e){if(!e.length){return}if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){e.wpColorPicker(o.defaults.color_picker);e.each(function(){var e=jQuery(this);e.wpColorPicker("color",e.val());e.trigger("change")})}else{e.each(function(e){n(this).after('<div id="picker-'+e+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');n("#picker-"+e).hide().farbtastic(n(this))}).focus(function(){n(this).next().show()}).blur(function(){n(this).next().hide()})}};o.makeListSortable=function(){var e=o.metabox().find(".cmb2-media-status.cmb-attach-list");if(e.length){e.sortable({cursor:"move"}).disableSelection()}};o.maybeOembed=function(e){var t=n(this);var r=e.type;var i={focusout:function(){s(function(){o.spinner(".postbox .cmb2-metabox",true)},2e3)},keyup:function(){var n=function(t,n){return e.which<=n&&e.which>=t};if(n(48,90)||n(96,111)||n(8,9)||e.which===187||e.which===190){o.doAjax(t,e)}},paste:function(){s(function(){o.doAjax(t)},100)}};i[r]()};o.resizeoEmbeds=function(){o.metabox().each(function(){var e=n(this);var t=e.parents(".inside");var r=e.parents(".inner-sidebar").length||e.parents("#side-sortables").length;var i=r;var s=false;if(!t.length){return true}var u=t.width();if(o.styleBreakPoint>u){i=true;s=o.styleBreakPoint-62>u}u=i?u:Math.round(t.width()*.82*.97);var a=u-30;if(i&&!r&&!s){a=a-75}if(a>639){return true}var f=e.find(".cmb-type-oembed .embed-status");var l=f.children().not(".cmb2-remove-wrapper");if(!l.length){return true}l.each(function(){var e=n(this);var t=e.width();var r=e.height();var s=a;if(e.parents(".cmb-repeat-row").length&&!i){s=a-91;s=785>u?s-15:s}var o=Math.round(s*r/t);e.width(s).height(o)})})};o.log=function(){if(i.script_debug&&console&&typeof console.log==="function"){console.log.apply(console,arguments)}};o.spinner=function(e,t){if(t){n(".cmb-spinner",e).hide()}else{n(".cmb-spinner",e).show()}};o.doAjax=function(e){var t=e.val();if(t.length<6){return}var r=e.attr("id");var u=e.parents(".cmb-repeat-table  .cmb-row .cmb-td");u=u.length?u:e.parents(".cmb2-metabox .cmb-row .cmb-td");var a=n(".embed-status",u);var f=e.width();var l=n(":first-child",a);o.log("oembed_url",t,r);f=a.length&&l.length?l.width():e.width();o.spinner(u);n(".embed_wrap",u).html("");s(function(){if(n(".cmb2-oembed:focus").val()!==t){return}n.ajax({type:"post",dataType:"json",url:i.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:t,oembed_width:f>300?f:300,field_id:r,object_id:e.data("objectid"),object_type:e.data("objecttype"),cmb2_ajax_nonce:i.ajax_nonce},success:function(e){o.log(e);o.spinner(u,true);n(".embed_wrap",u).html(e.data)}})},500)};n(t).ready(o.init);return o}(window,document,jQuery)